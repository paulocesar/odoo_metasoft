// Generated by CoffeeScript 1.9.0
(function() {
  var Application, Metasoft, MetasoftRouter, app, displayHtml, jsRoot, menuHtml, metasoftRouter, tpls;

  jsRoot = this;

  Metasoft = jsRoot.Metasoft;

  tpls = Metasoft.tpls;

  Metasoft.init("metasoft");

  Metasoft.render("layout", {
    title: 'Metasoft'
  });

  displayHtml = function(name) {
    return "<div id='display-" + name + "' class='display'></div>";
  };

  menuHtml = function(display) {
    var category, name, subCategory;
    name = display.name, category = display.category, subCategory = display.subCategory;
    return "<a href='#page/" + name + "' class='list-group-item page-" + name + "'>" + subCategory + "</a>";
  };

  MetasoftRouter = Backbone.Router.extend({
    routes: {
      "page/:name": "goToPage"
    },
    goToPage: function(name) {
      var _ref, _ref1;
      if (this.previousPage == null) {
        this.previousPage = '';
      }
      if ((_ref = app.displaysById[this.previousPage]) != null) {
        _ref.onHide();
      }
      $('.display').hide();
      $("#display-" + name).show();
      this.previousPage = name;
      return (_ref1 = app.displaysById[name]) != null ? _ref1.onShow() : void 0;
    }
  });

  Backbone.history.start();

  Application = (function() {
    function Application() {
      var activate;
      this.displaysById = {};
      this.displaysContainer = Metasoft.container.find('#displayContainer');
      _.each(Metasoft.displays, (function(_this) {
        return function(method, name) {
          var display;
          name = Metasoft.utils.firstToLower(name);
          _this.displaysContainer.append(displayHtml(name));
          display = new method({
            name: name
          });
          return _this.displaysById[name] = display;
        };
      })(this));
      activate = function(el) {
        $('.btn-subcategory').removeClass('active');
        return $(el).addClass('active');
      };
      $('.btn-subcategory').on('click', function() {
        return activate($(this));
      });
      $('.category-menu a').on('click', function(ev) {
        var $c, $s, id, link, page;
        $c = $(ev.currentTarget);
        id = $c.attr('href');
        $s = $(".tab-content " + id + ".tab-pane a:first");
        activate($s);
        link = $s.attr('href');
        page = link.replace('#/page/', '');
        metasoftRouter.navigate(link);
        return metasoftRouter.goToPage(page);
      });
    }

    return Application;

  })();

  app = window.app = new Application();

  metasoftRouter = new MetasoftRouter();

  app.metasoftRouter = metasoftRouter;

  metasoftRouter.navigate('page/contas');

  metasoftRouter.goToPage('contas');

  Metasoft.fieldValidator.apply($('body'));

  Metasoft.hideLoading();

}).call(this);
