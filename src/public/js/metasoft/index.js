// Generated by CoffeeScript 1.9.0
(function() {
  var Application, Metasoft, MetasoftRouter, app, displayHtml, firstToLower, jsRoot, menuHtml, metasoftRouter, tpls;

  jsRoot = this;

  Metasoft = jsRoot.Metasoft;

  tpls = Metasoft.tpls;

  Metasoft.init("metasoft");

  Metasoft.render("layout", {
    title: 'Metasoft'
  });

  displayHtml = function(name) {
    return "<div id='display-" + name + "' class='display'></div>";
  };

  menuHtml = function(display) {
    var category, name, subCategory;
    name = display.name, category = display.category, subCategory = display.subCategory;
    return "<a href='#page/" + name + "' class='list-group-item page-" + name + "'>" + subCategory + "</a>";
  };

  firstToLower = function(str) {
    return str.charAt(0).toLowerCase() + str.slice(1);
  };

  Application = (function() {
    function Application() {
      this.displaysById = {};
      this.displaysContainer = Metasoft.container.find('#displayContainer');
      _.each(Metasoft.displays, (function(_this) {
        return function(method, name) {
          var display;
          name = firstToLower(name);
          _this.displaysContainer.append(displayHtml(name));
          display = new method({
            name: name
          });
          _this.displaysById[name] = display;
          return _this.addDisplayToMenu(display);
        };
      })(this));
    }

    Application.prototype.addDisplayToMenu = function(display) {
      if (display.addToGrid()) {
        return Metasoft.container.find('#menu').append(menuHtml(display));
      }
    };

    return Application;

  })();

  app = window.app = new Application();

  MetasoftRouter = Backbone.Router.extend({
    routes: {
      "page/:name": "goToPage"
    },
    goToPage: function(name) {
      $('.display').hide();
      return $("#display-" + name).show();
    }
  });

  metasoftRouter = new MetasoftRouter();

  app.metasoftRouter = metasoftRouter;

  Backbone.history.start();

  metasoftRouter.navigate('page/contas');

  metasoftRouter.goToPage('contas');

  Metasoft.components.fieldValidator.apply($('body'));

}).call(this);
