// Generated by CoffeeScript 1.9.0
(function() {
  var $, Metasoft, jsRoot, rgxTag, rgxUnwatedChars, rgxWhitespace, sanitizeString, _;

  jsRoot = this;

  _ = jsRoot._, $ = jsRoot.$, Metasoft = jsRoot.Metasoft;

  rgxWhitespace = /[\s]+/g;

  rgxTag = /\<[^>]*\>/g;

  rgxUnwatedChars = /[,.$-]/g;

  sanitizeString = function(str) {
    return $.trim(str).toLowerCase().replace(rgxWhitespace, ' ').replace(rgxTag, '').replace(rgxUnwatedChars, '');
  };

  Metasoft.filter = function(el, query) {
    var terms;
    if (query == null) {
      query = '';
    }
    terms = sanitizeString(query).split(' ');
    terms = _.filter(terms, function(t) {
      return t !== '';
    });
    if (_.isEmpty(terms)) {
      $(el).find('tr').removeClass('hidden');
      return;
    }
    return $(el).find('tr').each(function() {
      var $tr, content, hasTerm, term, _i, _len;
      hasTerm = true;
      $tr = $(this);
      content = '';
      $tr.find('td').each(function() {
        content += ' ';
        return content += ($(this).html() || '').toLowerCase();
      });
      content = sanitizeString(content);
      for (_i = 0, _len = terms.length; _i < _len; _i++) {
        term = terms[_i];
        if (content.indexOf(term) === -1) {
          hasTerm = false;
        }
      }
      return $tr.toggleClass('hidden', !hasTerm);
    });
  };

}).call(this);
